{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./css/NotificationButton.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function NotificationButton(_ref){var _match$localteam,_match$visitorteam;let{match}=_ref;const[enabled,setEnabled]=useState(()=>{const list=JSON.parse(localStorage.getItem('notifiedMatches')||'[]');return list.includes(match.id);});const[showDialog,setShowDialog]=useState(false);const handleToggle=()=>{const list=JSON.parse(localStorage.getItem('notifiedMatches')||'[]');let updated;if(enabled){updated=list.filter(id=>id!==match.id);localStorage.removeItem(\"scheduled_\".concat(match.id));}else{updated=[...list,match.id];localStorage.removeItem(\"scheduled_\".concat(match.id));// Reset if re-enabling\n}// Clear already sent notification keys on toggle for fresh testing\nObject.keys(localStorage).forEach(k=>{if(k.startsWith(\"notified_\".concat(match.id,\"_\"))){localStorage.removeItem(k);}});localStorage.setItem('notifiedMatches',JSON.stringify(updated));setEnabled(!enabled);setShowDialog(true);};useEffect(()=>{if(Notification&&Notification.permission!=='granted'){Notification.requestPermission();}},[]);useEffect(()=>{if(showDialog){const timer=setTimeout(()=>{setShowDialog(false);},3000);return()=>clearTimeout(timer);}},[showDialog]);useEffect(()=>{if(!(match!==null&&match!==void 0&&match.starting_at))return;const list=JSON.parse(localStorage.getItem('notifiedMatches')||'[]');if(!list.includes(match.id))return;const scheduledKey=\"scheduled_\".concat(match.id);if(localStorage.getItem(scheduledKey))return;const matchTime=new Date(match.starting_at).getTime();const now=Date.now();const times=[{offsetMs:2200380000,key:'10min',body:'Match starts in 10 minutes!'},{offsetMs:0,key:'start',body:'Match has started!'}];const timers=[];times.forEach(_ref2=>{let{offsetMs,key,body}=_ref2;const delay=matchTime-now-offsetMs;const notifKey=\"notified_\".concat(match.id,\"_\").concat(key);if(delay>0&&!localStorage.getItem(notifKey)){timers.push(setTimeout(()=>{new Notification(\"\".concat(match.localteam.name,\" vs \").concat(match.visitorteam.name),{body});localStorage.setItem(notifKey,'1');// Mark as sent\n},delay));}});// Mark as scheduled\nlocalStorage.setItem(scheduledKey,'1');return()=>timers.forEach(clearTimeout);},[match]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"notify-btn\",onClick:e=>{e.stopPropagation();handleToggle();},children:enabled?'ðŸ”” On':'ðŸ”• Off'}),showDialog&&/*#__PURE__*/_jsx(\"div\",{className:\"notify-dialog\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"notify-dialog-content\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Notifications \",enabled?'enabled':'disabled',\" for\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"strong\",{children:[(_match$localteam=match.localteam)===null||_match$localteam===void 0?void 0:_match$localteam.name,\" vs \",(_match$visitorteam=match.visitorteam)===null||_match$visitorteam===void 0?void 0:_match$visitorteam.name]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"close-btn\",onClick:()=>setShowDialog(false),children:\"\\xD7\"})]})})]});}","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","NotificationButton","_ref","_match$localteam","_match$visitorteam","match","enabled","setEnabled","list","JSON","parse","localStorage","getItem","includes","id","showDialog","setShowDialog","handleToggle","updated","filter","removeItem","concat","Object","keys","forEach","k","startsWith","setItem","stringify","Notification","permission","requestPermission","timer","setTimeout","clearTimeout","starting_at","scheduledKey","matchTime","Date","getTime","now","times","offsetMs","key","body","timers","_ref2","delay","notifKey","push","localteam","name","visitorteam","children","className","onClick","e","stopPropagation"],"sources":["/Users/ashwin.r1/Downloads/live-cricket-scores-main/frontend/src/components/NotificationButton.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './css/NotificationButton.css';\n\nexport default function NotificationButton({ match }) {\n  const [enabled, setEnabled] = useState(() => {\n    const list = JSON.parse(localStorage.getItem('notifiedMatches') || '[]');\n    return list.includes(match.id);\n  });\n  const [showDialog, setShowDialog] = useState(false);\n\n  const handleToggle = () => {\n    const list = JSON.parse(localStorage.getItem('notifiedMatches') || '[]');\n    let updated;\n\n    if (enabled) {\n      updated = list.filter(id => id !== match.id);\n      localStorage.removeItem(`scheduled_${match.id}`);\n    } else {\n      updated = [...list, match.id];\n      localStorage.removeItem(`scheduled_${match.id}`); // Reset if re-enabling\n    }\n\n    // Clear already sent notification keys on toggle for fresh testing\n    Object.keys(localStorage).forEach(k => {\n      if (k.startsWith(`notified_${match.id}_`)) {\n        localStorage.removeItem(k);\n      }\n    });\n\n    localStorage.setItem('notifiedMatches', JSON.stringify(updated));\n    setEnabled(!enabled);\n    setShowDialog(true);\n  };\n\n  useEffect(() => {\n    if (Notification && Notification.permission !== 'granted') {\n      Notification.requestPermission();\n    }\n  }, []);\n\n  useEffect(() => {\n    if (showDialog) {\n      const timer = setTimeout(() => {\n        setShowDialog(false);\n      }, 3000);\n      return () => clearTimeout(timer);\n    }\n  }, [showDialog]);  useEffect(() => {\n    if (!match?.starting_at) return;\n\n    const list = JSON.parse(localStorage.getItem('notifiedMatches') || '[]');\n    if (!list.includes(match.id)) return;\n\n    const scheduledKey = `scheduled_${match.id}`;\n    if (localStorage.getItem(scheduledKey)) return;\n\n    const matchTime = new Date(match.starting_at).getTime();\n    const now = Date.now();\n\n    const times = [\n      {\n        offsetMs: 2200380000,\n        key: '10min',\n        body: 'Match starts in 10 minutes!',\n      },\n      {\n        offsetMs: 0,\n        key: 'start',\n        body: 'Match has started!',\n      }\n    ];\n\n    const timers = [];\n\n    times.forEach(({ offsetMs, key, body }) => {\n      const delay = matchTime - now - offsetMs;\n      const notifKey = `notified_${match.id}_${key}`;\n\n      if (delay > 0 && !localStorage.getItem(notifKey)) {\n        timers.push(setTimeout(() => {\n          new Notification(`${match.localteam.name} vs ${match.visitorteam.name}`, {\n            body,\n          });\n          localStorage.setItem(notifKey, '1'); // Mark as sent\n        }, delay));\n      }\n    });\n\n    // Mark as scheduled\n    localStorage.setItem(scheduledKey, '1');\n\n    return () => timers.forEach(clearTimeout);\n  }, [match]);\n\n  return (\n    <>\n      <button\n        className=\"notify-btn\"\n        onClick={(e) => {\n          e.stopPropagation();\n          handleToggle();\n        }}\n      >\n        {enabled ? 'ðŸ”” On' : 'ðŸ”• Off'}\n      </button>\n\n      {showDialog && (\n        <div className=\"notify-dialog\">\n          <div className=\"notify-dialog-content\">\n            <span>\n              Notifications {enabled ? 'enabled' : 'disabled'} for<br />\n              <strong>{match.localteam?.name} vs {match.visitorteam?.name}</strong>\n            </span>\n            <button className=\"close-btn\" onClick={() => setShowDialog(false)}>Ã—</button>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}